language: cpp

sudo: false

addons:
  apt:
    packages:
     - ocl-icd-opencl-dev
     - python2.7-dev
     - python3.4-dev
     - libfreetype6-dev
     - libgl1-mesa-dev
     - libgles2-mesa-dev
     - libncurses5-dev
     - zlib1g-dev
     - libopenal-dev
     - liblua5.2-dev
     - libbullet-dev
     - libogg-dev
     - libvorbis-dev

matrix:
  include:
    - os: linux
      language: android
      env: COMPILER=gcc COMPILER_VERSION=4.9.x TARGET_OS=android_nougat_7.1 FLAVOR=debug
           CONFIGURE_OPTIONS="--android-sdk-path=/usr/local/android-sdk/ --android-ndk-path=/usr/local/android-sdk/ndk-bundle"
           BUILD_DYNAMIC=no BUILD_STATIC=no
      android:
        components:
          - tools
          - platform-tools
          - tools
          - build-tools-27.0.3
          - android-26
      before_install:
        - mkdir $ANDROID_HOME/licenses
        - echo -ne "\n8933bad161af4178b1185d1a37fbf41ea5269c55" >> $ANDROID_HOME/licenses/android-sdk-license
        - echo y | /usr/local/android-sdk/tools/bin/sdkmanager "ndk-bundle"
    - os: linux
      language: android
      env: COMPILER=gcc COMPILER_VERSION=4.9.x TARGET_OS=android_nougat_7.1 FLAVOR=profile
           CONFIGURE_OPTIONS="--android-sdk-path=/usr/local/android-sdk/ --android-ndk-path=/usr/local/android-sdk/ndk-bundle"
           BUILD_DYNAMIC=no BUILD_STATIC=no
      android:
        components:
          - tools
          - platform-tools
          - tools
          - build-tools-27.0.3
          - android-26
      before_install:
        - mkdir $ANDROID_HOME/licenses
        - echo -ne "\n8933bad161af4178b1185d1a37fbf41ea5269c55" >> $ANDROID_HOME/licenses/android-sdk-license
        - echo y | /usr/local/android-sdk/tools/bin/sdkmanager "ndk-bundle"
    - os: linux
      language: android
      env: COMPILER=gcc COMPILER_VERSION=4.9.x TARGET_OS=android_nougat_7.1 FLAVOR=final
           CONFIGURE_OPTIONS="--android-sdk-path=/usr/local/android-sdk/ --android-ndk-path=/usr/local/android-sdk/ndk-bundle"
           BUILD_DYNAMIC=no BUILD_STATIC=no
      android:
        components:
          - tools
          - platform-tools
          - tools
          - build-tools-27.0.3
          - android-26
      before_install:
        - mkdir $ANDROID_HOME/licenses
        - echo -ne "\n8933bad161af4178b1185d1a37fbf41ea5269c55" >> $ANDROID_HOME/licenses/android-sdk-license
        - echo y | /usr/local/android-sdk/tools/bin/sdkmanager "ndk-bundle"
    - os: linux
      language: android
      env: COMPILER=gcc COMPILER_VERSION=4.9.x TARGET_OS=android_oreo_8.0 FLAVOR=debug
           CONFIGURE_OPTIONS="--android-sdk-path=/usr/local/android-sdk/ --android-ndk-path=/usr/local/android-sdk/ndk-bundle"
           BUILD_DYNAMIC=no BUILD_STATIC=no
      android:
        components:
          - tools
          - platform-tools
          - tools
          - build-tools-27.0.3
          - android-26
      before_install:
        - mkdir $ANDROID_HOME/licenses
        - echo -ne "\n8933bad161af4178b1185d1a37fbf41ea5269c55" >> $ANDROID_HOME/licenses/android-sdk-license
        - echo y | /usr/local/android-sdk/tools/bin/sdkmanager "ndk-bundle"
    - os: linux
      language: android
      env: COMPILER=gcc COMPILER_VERSION=4.9.x TARGET_OS=android_oreo_8.0 FLAVOR=profile
           CONFIGURE_OPTIONS="--android-sdk-path=/usr/local/android-sdk/ --android-ndk-path=/usr/local/android-sdk/ndk-bundle"
           BUILD_DYNAMIC=no BUILD_STATIC=no
      android:
        components:
          - tools
          - platform-tools
          - tools
          - build-tools-27.0.3
          - android-26
      before_install:
        - mkdir $ANDROID_HOME/licenses
        - echo -ne "\n8933bad161af4178b1185d1a37fbf41ea5269c55" >> $ANDROID_HOME/licenses/android-sdk-license
        - echo y | /usr/local/android-sdk/tools/bin/sdkmanager "ndk-bundle"
    - os: linux
      language: android
      env: COMPILER=gcc COMPILER_VERSION=4.9.x TARGET_OS=android_oreo_8.0 FLAVOR=final
           CONFIGURE_OPTIONS="--android-sdk-path=/usr/local/android-sdk/ --android-ndk-path=/usr/local/android-sdk/ndk-bundle"
           BUILD_DYNAMIC=no BUILD_STATIC=no
      android:
        components:
          - tools
          - platform-tools
          - tools
          - build-tools-27.0.3
          - android-26
      before_install:
        - mkdir $ANDROID_HOME/licenses
        - echo -ne "\n8933bad161af4178b1185d1a37fbf41ea5269c55" >> $ANDROID_HOME/licenses/android-sdk-license
        - echo y | /usr/local/android-sdk/tools/bin/sdkmanager "ndk-bundle"
    - os: linux
      language: android
      env: COMPILER=clang COMPILER_VERSION=6.0.2 TARGET_OS=android_nougat_7.1 FLAVOR=debug
           CONFIGURE_OPTIONS="--android-sdk-path=/usr/local/android-sdk/ --android-ndk-path=/usr/local/android-sdk/ndk-bundle"
           BUILD_DYNAMIC=no BUILD_STATIC=no
      android:
        components:
          - tools
          - platform-tools
          - tools
          - build-tools-27.0.3
          - android-26
      before_install:
        - mkdir $ANDROID_HOME/licenses
        - echo -ne "\n8933bad161af4178b1185d1a37fbf41ea5269c55" >> $ANDROID_HOME/licenses/android-sdk-license
        - echo y | /usr/local/android-sdk/tools/bin/sdkmanager "ndk-bundle"
    - os: linux
      language: android
      env: COMPILER=clang COMPILER_VERSION=6.0.2 TARGET_OS=android_nougat_7.1 FLAVOR=profile
           CONFIGURE_OPTIONS="--android-sdk-path=/usr/local/android-sdk/ --android-ndk-path=/usr/local/android-sdk/ndk-bundle"
           BUILD_DYNAMIC=no BUILD_STATIC=no
      android:
        components:
          - tools
          - platform-tools
          - tools
          - build-tools-27.0.3
          - android-26
      before_install:
        - mkdir $ANDROID_HOME/licenses
        - echo -ne "\n8933bad161af4178b1185d1a37fbf41ea5269c55" >> $ANDROID_HOME/licenses/android-sdk-license
        - echo y | /usr/local/android-sdk/tools/bin/sdkmanager "ndk-bundle"
    - os: linux
      language: android
      env: COMPILER=clang COMPILER_VERSION=6.0.2 TARGET_OS=android_nougat_7.1 FLAVOR=final
           CONFIGURE_OPTIONS="--android-sdk-path=/usr/local/android-sdk/ --android-ndk-path=/usr/local/android-sdk/ndk-bundle"
           BUILD_DYNAMIC=no BUILD_STATIC=no
      android:
        components:
          - tools
          - platform-tools
          - tools
          - build-tools-27.0.3
          - android-26
      before_install:
        - mkdir $ANDROID_HOME/licenses
        - echo -ne "\n8933bad161af4178b1185d1a37fbf41ea5269c55" >> $ANDROID_HOME/licenses/android-sdk-license
        - echo y | /usr/local/android-sdk/tools/bin/sdkmanager "ndk-bundle"
    - os: linux
      language: android
      env: COMPILER=clang COMPILER_VERSION=6.0.2 TARGET_OS=android_oreo_8.0 FLAVOR=debug
           CONFIGURE_OPTIONS="--android-sdk-path=/usr/local/android-sdk/ --android-ndk-path=/usr/local/android-sdk/ndk-bundle"
           BUILD_DYNAMIC=no BUILD_STATIC=no
      android:
        components:
          - tools
          - platform-tools
          - tools
          - build-tools-27.0.3
          - android-26
      before_install:
        - mkdir $ANDROID_HOME/licenses
        - echo -ne "\n8933bad161af4178b1185d1a37fbf41ea5269c55" >> $ANDROID_HOME/licenses/android-sdk-license
        - echo y | /usr/local/android-sdk/tools/bin/sdkmanager "ndk-bundle"
    - os: linux
      language: android
      env: COMPILER=clang COMPILER_VERSION=6.0.2 TARGET_OS=android_oreo_8.0 FLAVOR=profile
           CONFIGURE_OPTIONS="--android-sdk-path=/usr/local/android-sdk/ --android-ndk-path=/usr/local/android-sdk/ndk-bundle"
           BUILD_DYNAMIC=no BUILD_STATIC=no
      android:
        components:
          - tools
          - platform-tools
          - tools
          - build-tools-27.0.3
          - android-26
      before_install:
        - mkdir $ANDROID_HOME/licenses
        - echo -ne "\n8933bad161af4178b1185d1a37fbf41ea5269c55" >> $ANDROID_HOME/licenses/android-sdk-license
        - echo y | /usr/local/android-sdk/tools/bin/sdkmanager "ndk-bundle"
    - os: linux
      language: android
      env: COMPILER=clang COMPILER_VERSION=6.0.2 TARGET_OS=android_oreo_8.0 FLAVOR=final
           CONFIGURE_OPTIONS="--android-sdk-path=/usr/local/android-sdk/ --android-ndk-path=/usr/local/android-sdk/ndk-bundle"
           BUILD_DYNAMIC=no BUILD_STATIC=no
      android:
        components:
          - tools
          - platform-tools
          - tools
          - build-tools-27.0.3
          - android-26
      before_install:
        - mkdir $ANDROID_HOME/licenses
        - echo -ne "\n8933bad161af4178b1185d1a37fbf41ea5269c55" >> $ANDROID_HOME/licenses/android-sdk-license
        - echo y | /usr/local/android-sdk/tools/bin/sdkmanager "ndk-bundle"
    - os: linux
      env: COMPILER=gcc_amd64 COMPILER_VERSION=4.8.4 TARGET_OS=linux_amd64 FLAVOR=debug
    - os: linux
      env: COMPILER=gcc_amd64 COMPILER_VERSION=4.8.4 TARGET_OS=linux_amd64 FLAVOR=profile
    - os: linux
      env: COMPILER=gcc_amd64 COMPILER_VERSION=4.8.4 TARGET_OS=linux_amd64 FLAVOR=final
    - os: linux
      env: COMPILER=clang_amd64 COMPILER_VERSION=5.0.0 TARGET_OS=linux_amd64 FLAVOR=debug
    - os: linux
      env: COMPILER=clang_amd64 COMPILER_VERSION=5.0.0 TARGET_OS=linux_amd64 FLAVOR=profile
    - os: linux
      env: COMPILER=clang_amd64 COMPILER_VERSION=5.0.0 TARGET_OS=linux_amd64 FLAVOR=final
    - os: linux
      env: COMPILER=gcc_x86 COMPILER_VERSION=4.2.1 TARGET_OS=windows_x86 FLAVOR=debug
    - os: linux
      env: COMPILER=gcc_x86 COMPILER_VERSION=4.2.1 TARGET_OS=windows_x86 FLAVOR=profile
    - os: linux
      env: COMPILER=gcc_x86 COMPILER_VERSION=4.2.1 TARGET_OS=windows_x86 FLAVOR=final
    - os: osx
      env: COMPILER=appleclang COMPILER_VERSION=9.1.0 TARGET_OS=macosx10.13 FLAVOR=debug
    - os: osx
      env: COMPILER=appleclang COMPILER_VERSION=9.1.0 TARGET_OS=macosx10.13 FLAVOR=profile
    - os: osx
      env: COMPILER=appleclang COMPILER_VERSION=9.1.0 TARGET_OS=macosx10.13 FLAVOR=final
    - os: osx
      env: COMPILER=appleclang_arm64 COMPILER_VERSION=9.1.0 TARGET_OS=iphone11.4_arm64 FLAVOR=debug
    - os: osx
      env: COMPILER=appleclang_arm64 COMPILER_VERSION=9.1.0 TARGET_OS=iphone11.4_arm64 FLAVOR=profile
    - os: osx
      env: COMPILER=appleclang_arm64 COMPILER_VERSION=9.1.0 TARGET_OS=iphone11.4_arm64 FLAVOR=final
    - os: osx
      env: COMPILER=appleclang_amd64 COMPILER_VERSION=9.1.0 TARGET_OS=iphonesimulator11.4_amd64 FLAVOR=debug
    - os: osx
      env: COMPILER=appleclang_amd64 COMPILER_VERSION=9.1.0 TARGET_OS=iphonesimulator11.4_amd64 FLAVOR=profile
    - os: osx
      env: COMPILER=appleclang_amd64 COMPILER_VERSION=9.1.0 TARGET_OS=iphonesimulator11.4_amd64 FLAVOR=final

script:
  - CC= CXX= ./waf configure ${CONFIGURE_OPTIONS}
  - ./waf build:${TARGET_OS}-${COMPILER}-${COMPILER_VERSION}:${FLAVOR}
  - if [[ "x${BUILD_STATIC}" != "xno" ]]; then
        ./waf build:${TARGET_OS}-${COMPILER}-${COMPILER_VERSION}:${FLAVOR} --static;
    fi
  - if [[ "x${BUILD_DYNAMIC}" != "xno" ]]; then
        ./waf build:${TARGET_OS}-${COMPILER}-${COMPILER_VERSION}:${FLAVOR} --dynamic;
    fi
  - if [[ "x${BUILD_NOMASTER}" != "xno" ]]; then
        ./waf build:${TARGET_OS}-${COMPILER}-${COMPILER_VERSION}:${FLAVOR} --nomaster;
    fi
  - if [[ "x${BUILD_INCLUDED_LIBS}" != "xno" ]]; then
        ./waf build:${TARGET_OS}-${COMPILER}-${COMPILER_VERSION}:${FLAVOR} --nomaster
            --with-included-bullet --with-included-freetype --with-included-lua --with-included-squirrel
            --with-included-zlib --with-included-minizip --with-included-oggvorbis;
    fi

